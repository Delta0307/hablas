CC := /home/t_user/zsx-home/code/compiler/bin/haclc
rt_path := /home/t_user/zsx-home/code/include

LIB :=
INC := -I${rt_path} -I./include
FLAG :=
ARCH := -DASCEND910B
TBE :=#-DTBE
all :

install: hgemm hgemm_batched hgemm_strided_batched hsyrk hsyr2k hgemv sgemv ssymv hsymv csymv htrmv strmv ctrmv ./src/handle.cc ./src/hablas.cc
	g++ -fpic ${INC} -c ./src/handle.cc -o ./build/handle.o
	g++ -fpic ${INC} ${ARCH} -c ./src/hablas.cc -o ./build/hablas.o
	g++ -shared ./build/handle.o ./build/hablas.o ./build/elf_hablas_hgemm_kernel.o ./build/elf_hablas_hgemm_batched_kernel.o ./build/elf_hablas_hgemm_strided_batched_kernel.o ./build/elf_hablas_hsyrk_kernel.o ./build/elf_hablas_hsyr2k_kernel.o ./build/elf_hablas_hgemv_kernel.o ./build/elf_hablas_sgemv_kernel.o ./build/elf_hablas_ssymv_kernel.o ./build/elf_hablas_hsymv_kernel.o ./build/elf_hablas_csymv_kernel.o ./build/elf_hablas_htrmv_main_kernel.o ./build/elf_hablas_htrmv_copy_kernel.o ./build/elf_hablas_strmv_main_kernel.o ./build/elf_hablas_strmv_copy_kernel.o ./build/elf_hablas_ctrmv_main_kernel.o ./build/elf_hablas_ctrmv_copy_kernel.o -o ./lib/libhablas.so

hgemm: ./src/kernel/hgemm.cc
	${CC} -c ./src/kernel/hgemm.cc --hacl-device-only ${INC} ${TBE} -o ./build/hablas_hgemm_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_hgemm_kernel.o ./build/elf_hablas_hgemm_kernel.o

hgemm_batched: ./src/kernel/hgemm_batched.cc
	${CC} -c ./src/kernel/hgemm_batched.cc --hacl-device-only ${INC} -o ./build/hablas_hgemm_batched_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_hgemm_batched_kernel.o ./build/elf_hablas_hgemm_batched_kernel.o

hgemm_strided_batched: ./src/kernel/hgemm_strided_batched.cc
	${CC} -c ./src/kernel/hgemm_strided_batched.cc --hacl-device-only ${INC} -o ./build/hablas_hgemm_strided_batched_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_hgemm_strided_batched_kernel.o ./build/elf_hablas_hgemm_strided_batched_kernel.o

hsyrk: ./src/kernel/hsyrk.cc
	${CC} -c ./src/kernel/hsyrk.cc --hacl-device-only ${INC} -o ./build/hablas_hsyrk_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_hsyrk_kernel.o ./build/elf_hablas_hsyrk_kernel.o

hsyr2k: ./src/kernel/hsyr2k.cc
	${CC} -c ./src/kernel/hsyr2k.cc --hacl-device-only ${INC} -o ./build/hablas_hsyr2k_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_hsyr2k_kernel.o ./build/elf_hablas_hsyr2k_kernel.o

hgemv: ./src/kernel/hgemv.cc
	${CC} -c ./src/kernel/hgemv.cc --hacl-device-only ${INC} -o ./build/hablas_hgemv_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_hgemv_kernel.o ./build/elf_hablas_hgemv_kernel.o

sgemv: ./src/kernel/sgemv.cc
	${CC} -c ./src/kernel/sgemv.cc --hacl-device-only ${INC} -o ./build/hablas_sgemv_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_sgemv_kernel.o ./build/elf_hablas_sgemv_kernel.o

hsymv: ./src/kernel/hsymv.cc
	${CC} -c ./src/kernel/hsymv.cc --hacl-device-only ${INC} -o ./build/hablas_hsymv_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_hsymv_kernel.o ./build/elf_hablas_hsymv_kernel.o

ssymv: ./src/kernel/sgemv.cc
	${CC} -c ./src/kernel/ssymv.cc --hacl-device-only ${INC} -o ./build/hablas_ssymv_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_ssymv_kernel.o ./build/elf_hablas_ssymv_kernel.o

csymv: ./src/kernel/csymv.cc
	${CC} -c ./src/kernel/csymv.cc --hacl-device-only ${INC} -o ./build/hablas_csymv_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_csymv_kernel.o ./build/elf_hablas_csymv_kernel.o

htrmv: ./src/kernel/htrmv_main_kernel.cc
	${CC} -c ./src/kernel/htrmv_main_kernel.cc --hacl-device-only ${INC} -o ./build/hablas_htrmv_main_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_htrmv_main_kernel.o ./build/elf_hablas_htrmv_main_kernel.o
	${CC} -c ./src/kernel/htrmv_copy_kernel.cc --hacl-device-only ${INC} -o ./build/hablas_htrmv_copy_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_htrmv_copy_kernel.o ./build/elf_hablas_htrmv_copy_kernel.o

strmv: ./src/kernel/strmv_main_kernel.cc
	${CC} -c ./src/kernel/strmv_main_kernel.cc --hacl-device-only ${INC} -o ./build/hablas_strmv_main_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_strmv_main_kernel.o ./build/elf_hablas_strmv_main_kernel.o
	${CC} -c ./src/kernel/strmv_copy_kernel.cc --hacl-device-only ${INC} -o ./build/hablas_strmv_copy_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_strmv_copy_kernel.o ./build/elf_hablas_strmv_copy_kernel.o

ctrmv: ./src/kernel/ctrmv_main_kernel.cc
	${CC} -c ./src/kernel/ctrmv_main_kernel.cc --hacl-device-only ${INC} -o ./build/hablas_ctrmv_main_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_ctrmv_main_kernel.o ./build/elf_hablas_ctrmv_main_kernel.o
	${CC} -c ./src/kernel/ctrmv_copy_kernel.cc --hacl-device-only ${INC} -o ./build/hablas_ctrmv_copy_kernel.o
	./bin/run_elf_change_hacl_kernel ./build/hablas_ctrmv_copy_kernel.o ./build/elf_hablas_ctrmv_copy_kernel.o

clean:
	rm ./build/*